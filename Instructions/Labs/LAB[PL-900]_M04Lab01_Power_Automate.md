---
lab:
  title: Лабораторная работа 4. Создание автоматизированного решения
  module: 'Module 4: Get Started with Power Automate'
---

# Лабораторная работа 4. Создание автоматизированного решения

**Клиенты WWL — условия использования** Если вам предоставляется клиент в рамках обучения под руководством инструктора, обратите внимание, что клиент предоставляется для поддержки практических лабораторий в обучении под руководством инструктора. Клиенты не должны совместно использоваться или использоваться для целей за пределами практических лабораторий. Клиент, используемый в этом курсе, является клиентом пробной версии и не может быть использован или доступен после окончания класса и не имеет права на расширение. Клиенты не должны быть преобразованы в платную подписку. Клиенты, полученные в рамках этого курса, остаются собственностью корпорации Майкрософт, и мы оставляем за собой право получить доступ и репозитории в любое время. 

## Сценарий

Bellows College — образовательное учреждение, имеющее на территории своего кампуса несколько зданий. Сейчас для регистрации посетителей кампуса используются бумажные журналы. Информация собирается несогласованно, отсутствуют средства сбора и анализа данных о визитах по всему кампусу.

Администрация кампуса хотела бы модернизировать систему регистрации посетителей таким образом, чтобы допуск в здания контролировали сотрудники службы безопасности, а обитатели кампуса предварительно регистрировали все визиты и обязательно записывали их.

В этом курсе обучения вы разработаете приложения и реализуете автоматические процедуры, позволяющие администрации и службе охраны Bellows College контролировать доступ в здания кампуса.

В этом задании вы создадите поток Power Automate для отправки электронной почты посетителю при назначении визита.

## Обзор этапов работы над общим заданием

Для выполнения проекта необходимо выполнить следующие требования.

- При назначении визита контактные лица должны получать уведомления по электронной почте.

## Предварительные требования

- Выполнить **задание 0 модуля 0 «Проверка лабораторной среды»** .
- Выполнить **задание 1 модуля 2 "Моделирование данных"** .
- Выполнить **задание 3 модуля 2 "Создание приложения на основе модели"** .
- Созданный контакт Джона Доу с заполненным личным адресом электронной почты.

## Упражнение 1. Создание потока уведомлений о визитах

**Цель упражнения.** В этом упражнении вы создадите поток Power Automate, который реализует данное требование. Посетителю необходимо отправить электронное письмо с уникальным кодом, присвоенным визиту при создании.

### Задача \#1. Создание потока

1.  Перейдите к <https://make.powerapps.com>. При необходимости повторной аутентификации нажмите **Войти** и следуйте указаниям на экране.

2.  В правом верхнем углу экрана выберите свою среду **[ваши инициалы] практика** (если она еще не выбрана).

3.  В левой области навигации щелкните **Потоки**.

4.  При появлении запроса выберите **Начало работы**.

5.  Щелкните **Создать поток** и выберите **Автоматизированный облачный поток**.

6.  Введите "Уведомление о визите"в поле **Имя потока**.

7.  В разделе **Выбор триггера потока** найдите **Dataverse**.

8.  Выберите триггер **При добавлении, изменении или удалении строки**, а затем нажмите кнопку **Создать**.

9.  Укажите условия триггера для потока, как показано ниже.

    1.  Выберите **Добавлено** для параметра **Тип изменения**

    2.  В поле **Имя таблицы** выберите **Визиты**.

    3.  В поле **Область действия** выберите **Организация**.

    4.  Для настройки шага триггера нажмите многоточие ( **...** ), затем **Переименовать**. Введите новое имя этого триггера **"При добавлении визита"** . Это позволит вам и другим редакторам потока понять назначение шага без изучения подробностей.

### Задача \#2. Создание шага для получения строки посетителя

1.  Выберите **+ Новый шаг**. Этот шаг необходим для получения сведений о посетителях, включающих адрес электронной почты.

2.  Найдите **Dataverse**.

3.  Выберите действие **Выбрать строку по идентификатору**.

4.  В поле **Имя таблицы** введите **Контакты**.

5.  Выберите поле **Идентификатор строки**. Вы увидите, что откроется окно для выбора динамического содержимого или выражений.

6.  В поле **Идентификатор строки** выберите **Посетитель (значение)** из списка динамического содержимого. На этом шаге вы ищете контактное лицо для строки с информацией о визите, при создании которой был активирован этот поток. Так как адрес электронной почты находится в таблице контактов, вам нужно получить эту информацию для отправки посетителю сообщения электронной почты.

7.  В определении этого действия нажмите многоточие ( **...** ), затем **Переименовать**.
        Введите новое имя этого действия **«Выбрать посетителя»** . Это позволит вам и другим редакторам потока понять назначение шага без изучения подробностей.

### Задача \#3. Создание шага для отправки посетителю электронного письма

1.  Нажмите кнопку **+ Новый шаг**. Это шаг предназначен для отправки посетителю электронного письма.

2.  Выполните поиск слова *почта*, выберите соединитель **Office 365 Outlook** и действие **Отправить по электронной почте (V2)** .

3.  Если появится запрос на принятие условий использования этого действия, щелкните **Принять**.

4.  В поле **Кому** выберите **Добавить динамическое содержимое**. 
    
5.  Выберите значение **Электронная почта** из списка динамического содержимого.
        > Notice that it is beneath the **Get the visitor** header. This means you
        are selecting the Email that is related to the Visitor that you looked
        up in the previous step.

6.  В поле **Тема** введите строку **Ваш запланированный визит в Bellows College**.

7.  В поле **Содержимое электронного письма** введите следующее:

>   Вместо полей, указанных в скобках, необходимо поместить динамическое содержимое. Рекомендуется сначала скопировать и вставить весь текст, затем добавить динамический контент в нужные места.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   Dear {First Name},

   You are currently scheduled to visit Bellows Campus from {Scheduled Start} until {Scheduled End}.

   Best regards,

   Campus Administration
   Bellows College
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

8.  Выделите текст **{Имя}** . Замените его значением поля **Имя** с шага **Получить посетителя**.

9.  Выделите текст **{Запланированное начало}** . Поместите сюда поле **Запланированное начало** из шага **При добавлении визита**.

10.  Выделите текст **{Запланированное окончание}** . Замените его полем **Запланированное окончание** из шага **При добавлении визита**.

11.  Выберите команду **Сохранить**.

Оставьте эту вкладку потока открытой для следующей задачи. Ваш поток должен выглядеть примерно так:

![Пример шагов потока.](media/4-Flow.png)

### Задача \#4. Проверка и тестирование потока

1.  Откройте новую вкладку в браузере и перейдите по адресу <https://make.powerapps.com>.

2.  В правом верхнем углу экрана выберите свою среду **[ваши инициалы] практика** (если она еще не выбрана).

3.  Щелкните **Приложения** и выберите приложение **Управление кампусом Bellows**, созданное ранее на основе модели.

3.  Оставив эту вкладку браузера открытой, вернитесь к предыдущей вкладке с вашим потоком.

4.  На панели команд щелкните **Тестировать**. Щелкните **Вручную**, а затем — **Тест**.

5.  Перейдите на вкладку браузера с открытым приложением на основе модели. 

6.  Используя навигацию в левой части экрана, выберите **Визиты**.

6. Нажмите кнопку **+Создать**, чтобы добавить новую запись **Визит**.

7. Заполните запись «Визит» следующим образом:

    -   **Имя**. Тестовый визит

    -   **Посетитель**. Александр Демидов

    -   **Запланированное начало**. Завтра в 8:00

    -   **Запланированное окончание**. Завтра в 9:00

8. Нажмите кнопку **Сохранить & Закрыть** .

9. Перейдите на вкладку браузера, где запущен тест потока. После короткой задержки вы увидите выполнение потока. Здесь вы сможете обнаружить проблемы, если они возникнут в потоке, или подтвердить его успешное выполнение.

После короткой задержки вы увидите сообщение электронной почты в папке "Входящие", так как вы указали электронную почту Александра Демидова в качестве своей личной электронной почты. Обратите внимание, что письмо может оказаться в папке нежелательной почты.

## Сложности

- Форматирование сообщения электронной почты. Как вы можете сделать его более профессиональным?
